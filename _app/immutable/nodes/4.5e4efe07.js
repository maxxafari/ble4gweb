import{s as $,n as U,r as ee}from"../chunks/scheduler.b0c1c2c3.js";import{S as te,i as le,g as m,s as T,h as C,j as b,y as P,c as w,f as _,a as y,A as p,m as F,n as H,k as B,D as G,C as R,o as Z,E as ne}from"../chunks/index.00179a67.js";import{e as X,P as oe}from"../chunks/simplepeer.min.88c063de.js";import{g as ae,A as se,W as re}from"../chunks/signalServer.39f3696e.js";const ie=!1,ce=!0,ge=Object.freeze(Object.defineProperty({__proto__:null,prerender:ce,ssr:ie},Symbol.toStringTag,{value:"Module"}));function J(f,e,l){const t=f.slice();return t[8]=e[l],t}function K(f){let e,l="<h4>Waiting for call from peer1</h4>";return{c(){e=m("div"),e.innerHTML=l},l(t){e=C(t,"DIV",{"data-svelte-h":!0}),P(e)!=="svelte-pb42gt"&&(e.innerHTML=l)},m(t,r){y(t,e,r)},d(t){t&&_(e)}}}function Q(f){let e,l,t="Connected",r,o,a,s=f[1]?"true":"false",c,u,k,h,g,x,N="Send",L,E,D,j="data",V,I,W,q,O=X(f[3]),d=[];for(let n=0;n<O.length;n+=1)d[n]=Y(J(f,O,n));return{c(){e=m("div"),l=m("h4"),l.textContent=t,r=T(),o=m("p"),a=F("connected: "),c=F(s),u=T(),k=m("div"),h=m("textarea"),g=T(),x=m("button"),x.textContent=N,L=T(),E=m("div"),D=m("h3"),D.textContent=j,V=T(),I=m("ul");for(let n=0;n<d.length;n+=1)d[n].c();this.h()},l(n){e=C(n,"DIV",{});var v=b(e);l=C(v,"H4",{"data-svelte-h":!0}),P(l)!=="svelte-znzixf"&&(l.textContent=t),r=w(v),o=C(v,"P",{});var i=b(o);a=H(i,"connected: "),c=H(i,s),i.forEach(_),v.forEach(_),u=w(n),k=C(n,"DIV",{});var S=b(k);h=C(S,"TEXTAREA",{id:!0,class:!0}),b(h).forEach(_),g=w(S),x=C(S,"BUTTON",{"data-svelte-h":!0}),P(x)!=="svelte-zad7q0"&&(x.textContent=N),S.forEach(_),L=w(n),E=C(n,"DIV",{});var A=b(E);D=C(A,"H3",{"data-svelte-h":!0}),P(D)!=="svelte-1fkupqc"&&(D.textContent=j),V=w(A),I=C(A,"UL",{});var M=b(I);for(let z=0;z<d.length;z+=1)d[z].l(M);M.forEach(_),A.forEach(_),this.h()},h(){B(h,"id","send"),B(h,"class","svelte-17de7ug")},m(n,v){y(n,e,v),p(e,l),p(e,r),p(e,o),p(o,a),p(o,c),y(n,u,v),y(n,k,v),p(k,h),G(h,f[2]),p(k,g),p(k,x),y(n,L,v),y(n,E,v),p(E,D),p(E,V),p(E,I);for(let i=0;i<d.length;i+=1)d[i]&&d[i].m(I,null);W||(q=[R(h,"input",f[4]),R(x,"click",f[5])],W=!0)},p(n,v){if(v&2&&s!==(s=n[1]?"true":"false")&&Z(c,s),v&4&&G(h,n[2]),v&8){O=X(n[3]);let i;for(i=0;i<O.length;i+=1){const S=J(n,O,i);d[i]?d[i].p(S,v):(d[i]=Y(S),d[i].c(),d[i].m(I,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=O.length}},d(n){n&&(_(e),_(u),_(k),_(L),_(E)),ne(d,n),W=!1,ee(q)}}}function Y(f){let e,l=f[8]+"",t;return{c(){e=m("li"),t=F(l)},l(r){e=C(r,"LI",{});var o=b(e);t=H(o,l),o.forEach(_)},m(r,o){y(r,e,o),p(e,t)},p(r,o){o&8&&l!==(l=r[8]+"")&&Z(t,l)},d(r){r&&_(e)}}}function fe(f){let e,l,t="Waiting for call (NOT initiator)",r,o,a=!f[1]&&K(),s=f[1]&&Q(f);return{c(){e=m("div"),l=m("p"),l.textContent=t,r=T(),a&&a.c(),o=T(),s&&s.c()},l(c){e=C(c,"DIV",{});var u=b(e);l=C(u,"P",{"data-svelte-h":!0}),P(l)!=="svelte-y1cfax"&&(l.textContent=t),r=w(u),a&&a.l(u),o=w(u),s&&s.l(u),u.forEach(_)},m(c,u){y(c,e,u),p(e,l),p(e,r),a&&a.m(e,null),p(e,o),s&&s.m(e,null)},p(c,[u]){c[1]?a&&(a.d(1),a=null):a||(a=K(),a.c(),a.m(e,o)),c[1]?s?s.p(c,u):(s=Q(c),s.c(),s.m(e,null)):s&&(s.d(1),s=null)},i:U,o:U,d(c){c&&_(e),a&&a.d(),s&&s.d()}}}let ue=!1;function de(f,e,l){let t=null,r=!1,o="",a=[];(async()=>{console.log("onload...");const h=await ae();l(0,t=new oe({initiator:ue,trickle:!1,config:{iceServers:h}})),t.on("error",g=>console.log("error",g)),t.on("signal",async g=>{console.info("answering call from peer1",g),se(g)}),t.on("connect",()=>{console.log("CONNECT"),l(1,r=!0),t==null||t.send("whatever"+new Date().toISOString())}),t.on("close",()=>{console.log("CLOSE"),l(1,r=!1)}),t.on("error",g=>{console.error("error",g),l(1,r=!1)}),t.on("data",g=>{console.log("GOT data:",g);try{a.push(g.toString()),l(3,a)}catch{console.error("could not parse data to string :/",g)}})})();async function c(){try{const h=await re();t==null||t.signal(h)}catch(h){console.error("Did not get a call from peer1",h),console.info("Waiting for call again..."),c()}}c();function u(){o=this.value,l(2,o)}return[t,r,o,a,u,()=>{t==null||t.send(o),l(2,o="")}]}class me extends te{constructor(e){super(),le(this,e,de,fe,$,{})}}export{me as component,ge as universal};
