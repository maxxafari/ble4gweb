import{s as $,h as D,n as u,o as E,b as F,c as M}from"./scheduler.da9d0849.js";import{S as C,i as x,g as _,s as N,h as g,z as U,c as q,j as y,f as c,k as R,a as f,C as H,m as w,n as k,A as T,o as V}from"./index.5d2acbf4.js";import{c as B,e as v,s as A,d as p}from"./Status.2ab7d4c4.js";function I(n){let t,a="Horn",e,s,i,r,l;return{c(){t=_("button"),t.textContent=a,e=N(),s=_("audio"),this.h()},l(o){t=g(o,"BUTTON",{"data-svelte-h":!0}),U(t)!=="svelte-yfn8cv"&&(t.textContent=a),e=q(o),s=g(o,"AUDIO",{src:!0}),y(s).forEach(c),this.h()},h(){D(s.src,i="/horn.wav")||R(s,"src",i)},m(o,h){f(o,t,h),f(o,e,h),f(o,s,h),n[2](s),r||(l=H(t,"click",n[0]),r=!0)},p:u,i:u,o:u,d(o){o&&(c(t),c(e),c(s)),n[2](null),r=!1,l()}}}function j(n,t,a){let e;function s(){e.play()}E(()=>B.subscribe(r=>{r.horn&&s()}));function i(r){F[r?"unshift":"push"](()=>{e=r,a(1,e)})}return[s,e,i]}class Q extends C{constructor(t){super(),x(this,t,j,I,$,{soundHorn:0})}get soundHorn(){return this.$$.ctx[0]}}function z(n){let t,a,e=n[0].lights?"OFF":"ON",s,i,r;return{c(){t=_("button"),a=w("Turn Lights "),s=w(e)},l(l){t=g(l,"BUTTON",{});var o=y(t);a=k(o,"Turn Lights "),s=k(o,e),o.forEach(c)},m(l,o){f(l,t,o),T(t,a),T(t,s),i||(r=H(t,"click",n[1]),i=!0)},p(l,[o]){o&1&&e!==(e=l[0].lights?"OFF":"ON")&&V(s,e)},i:u,o:u,d(l){l&&c(t),i=!1,r()}}}function P(n,t,a){let e;return M(n,B,i=>a(0,e=i)),v("lights",!0),[e,()=>{v("lights",!0)}]}class W extends C{constructor(t){super(),x(this,t,P,z,$,{})}}let S=null,m=new Date().getTime(),d=null,b;const L=90,X=n=>{b=n;const t=new Date().getTime();console.log("timeOut",d),t>m+L?(m=t,p.leds.setValRaw(b)):d||(d=setTimeout(()=>{p.leds.setValRaw(b),m=new Date().getTime(),d=null},L))};function Y(){S?console.info("bindStearingToBle: already subscribed"):(console.log("subscribing to stering store"),S=A.subscribe(n=>{if(!p.isConnected()){console.warn("command not sent, BLE not connected");return}const{lm:t,rm:a}=n,e=new TextEncoder().encode("XLRlr");e[1]=Math.abs(t),e[2]=Math.abs(a),e[3]=t<0?1:0,e[4]=a<0?1:0,X(e.buffer)}))}let O=null;const Z=async()=>{window&&(window==null||window.navigator.wakeLock.request("screen").then(n=>(O=n,O)).catch(n=>(console.log("wakeLock error",n),null)))};export{Q as H,W as L,Y as b,Z as p};
