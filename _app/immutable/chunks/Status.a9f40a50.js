import{f as Ae,s as se,n as te,r as Le,o as $e,b as Se,i as Te,c as Ge,h as Ne}from"./scheduler.45f36ff2.js";import{S as ae,i as ne,s as I,g as b,c as B,h as p,j as y,f as v,k as g,l as H,F as E,a as F,A as r,C as Ie,m as J,z as ee,n as Q,o as Z,G as Be,r as de,u as ve,v as me,d as he,t as ge,w as be}from"./index.3c897206.js";import{w as qe}from"./index.fd39fc71.js";import{s as K,u as Fe}from"./statusStore.c9e49bbf.js";const ke="stear",pe=qe({key:ke,lm:0,rm:0}),ze=t=>!!(typeof t=="object"&&t&&"key"in t&&t.key===ke),Ve=t=>{pe.update(s=>({...s,...t}))},nt=t=>{console.log("bindStearingStoreToConnDownStream"),t.on("data",s=>{ze(s)&&Ve(s)})},rt=t=>{console.log("bindStearingStoreToConnDownStream"),pe.subscribe(e=>{t.send(e)});const s=Ae(pe);t.send(s)};function Ce(t){let s,e="Gamepad connected",n,i,c,a,f,_,h;return{c(){s=b("span"),s.textContent=e,n=I(),i=b("div"),c=b("div"),a=J(t[0]),f=I(),_=b("div"),h=J(t[1]),this.h()},l(d){s=p(d,"SPAN",{"data-svelte-h":!0}),ee(s)!=="svelte-vjytum"&&(s.textContent=e),n=B(d),i=p(d,"DIV",{class:!0});var u=y(i);c=p(u,"DIV",{class:!0});var k=y(c);a=Q(k,t[0]),k.forEach(v),f=B(u),_=p(u,"DIV",{class:!0});var C=y(_);h=Q(C,t[1]),C.forEach(v),u.forEach(v),this.h()},h(){g(c,"class","svelte-ilam17"),g(_,"class","svelte-ilam17"),g(i,"class","vals svelte-ilam17")},m(d,u){F(d,s,u),F(d,n,u),F(d,i,u),r(i,c),r(c,a),r(i,f),r(i,_),r(_,h)},p(d,u){u&1&&Z(a,d[0]),u&2&&Z(h,d[1])},d(d){d&&(v(s),v(n),v(i))}}}function Me(t){let s,e,n,i,c,a,f,_,h,d,u,k,C,N,o,m,S,V,T,$,A,P,U,L,O,q,G,re,z,le,M,oe,X,ie,Y,ce,j,R,ue,W,x,fe,ye,D=t[3]&&Ce(t);return{c(){D&&D.c(),s=I(),e=b("section"),n=b("div"),i=I(),c=b("div"),a=b("div"),f=I(),_=b("div"),h=b("div"),d=I(),u=b("button"),k=I(),C=b("button"),N=I(),o=b("button"),m=I(),S=b("button"),V=I(),T=b("button"),$=I(),A=b("button"),P=I(),U=b("button"),L=I(),O=b("button"),q=I(),G=b("button"),re=I(),z=b("button"),le=I(),M=b("button"),oe=I(),X=b("button"),ie=I(),Y=b("button"),ce=I(),j=b("button"),ue=I(),W=b("button"),this.h()},l(w){D&&D.l(w),s=B(w),e=p(w,"SECTION",{class:!0});var l=y(e);n=p(l,"DIV",{class:!0}),y(n).forEach(v),i=B(l),c=p(l,"DIV",{class:!0});var we=y(c);a=p(we,"DIV",{class:!0,style:!0}),y(a).forEach(v),we.forEach(v),f=B(l),_=p(l,"DIV",{class:!0});var Ee=y(_);h=p(Ee,"DIV",{class:!0,style:!0}),y(h).forEach(v),Ee.forEach(v),d=B(l),u=p(l,"BUTTON",{class:!0}),y(u).forEach(v),k=B(l),C=p(l,"BUTTON",{class:!0}),y(C).forEach(v),N=B(l),o=p(l,"BUTTON",{class:!0}),y(o).forEach(v),m=B(l),S=p(l,"BUTTON",{class:!0}),y(S).forEach(v),V=B(l),T=p(l,"BUTTON",{class:!0}),y(T).forEach(v),$=B(l),A=p(l,"BUTTON",{class:!0}),y(A).forEach(v),P=B(l),U=p(l,"BUTTON",{class:!0}),y(U).forEach(v),L=B(l),O=p(l,"BUTTON",{class:!0}),y(O).forEach(v),q=B(l),G=p(l,"BUTTON",{class:!0}),y(G).forEach(v),re=B(l),z=p(l,"BUTTON",{class:!0}),y(z).forEach(v),le=B(l),M=p(l,"BUTTON",{class:!0}),y(M).forEach(v),oe=B(l),X=p(l,"BUTTON",{class:!0}),y(X).forEach(v),ie=B(l),Y=p(l,"BUTTON",{class:!0}),y(Y).forEach(v),ce=B(l),j=p(l,"BUTTON",{class:!0,style:!0}),y(j).forEach(v),ue=B(l),W=p(l,"BUTTON",{class:!0,style:!0}),y(W).forEach(v),l.forEach(v),this.h()},h(){g(n,"class","pad svelte-ilam17"),g(a,"class","stick svelte-ilam17"),H(a,"transform",t[6]()),E(a,"click",t[2].lstick),g(c,"class","well left svelte-ilam17"),g(h,"class","stick svelte-ilam17"),H(h,"transform",t[5]()),E(h,"click",t[2].rstick),g(_,"class","well right svelte-ilam17"),g(u,"class","button a svelte-ilam17"),E(u,"on",t[2].a),g(C,"class","button b svelte-ilam17"),E(C,"on",t[2].b),g(o,"class","button x svelte-ilam17"),E(o,"on",t[2].x),g(S,"class","button y svelte-ilam17"),E(S,"on",t[2].y),g(T,"class","button map svelte-ilam17"),E(T,"on",t[2].map),g(A,"class","button menu svelte-ilam17"),E(A,"on",t[2].menu),g(U,"class","button xbox svelte-ilam17"),E(U,"on",t[2].xbox),g(O,"class","dpad du svelte-ilam17"),E(O,"on",t[2].du),g(G,"class","dpad dr svelte-ilam17"),E(G,"on",t[2].dr),g(z,"class","dpad dd svelte-ilam17"),E(z,"on",t[2].dd),g(M,"class","dpad dl svelte-ilam17"),E(M,"on",t[2].dl),g(X,"class","bumper left svelte-ilam17"),E(X,"on",t[2].lb),g(Y,"class","bumper right svelte-ilam17"),E(Y,"on",t[2].rb),g(j,"class","trigger left svelte-ilam17"),g(j,"style",R=t[4]("lt")),g(W,"class","trigger right svelte-ilam17"),g(W,"style",x=t[4]("rt")),g(e,"class","controller svelte-ilam17")},m(w,l){D&&D.m(w,l),F(w,s,l),F(w,e,l),r(e,n),r(e,i),r(e,c),r(c,a),r(e,f),r(e,_),r(_,h),r(e,d),r(e,u),r(e,k),r(e,C),r(e,N),r(e,o),r(e,m),r(e,S),r(e,V),r(e,T),r(e,$),r(e,A),r(e,P),r(e,U),r(e,L),r(e,O),r(e,q),r(e,G),r(e,re),r(e,z),r(e,le),r(e,M),r(e,oe),r(e,X),r(e,ie),r(e,Y),r(e,ce),r(e,j),r(e,ue),r(e,W),fe||(ye=[Ie(window,"gamepadconnected",t[7]),Ie(window,"gamepaddisconnected",t[8])],fe=!0)},p(w,[l]){w[3]?D?D.p(w,l):(D=Ce(w),D.c(),D.m(s.parentNode,s)):D&&(D.d(1),D=null),l&64&&H(a,"transform",w[6]()),l&4&&E(a,"click",w[2].lstick),l&32&&H(h,"transform",w[5]()),l&4&&E(h,"click",w[2].rstick),l&4&&E(u,"on",w[2].a),l&4&&E(C,"on",w[2].b),l&4&&E(o,"on",w[2].x),l&4&&E(S,"on",w[2].y),l&4&&E(T,"on",w[2].map),l&4&&E(A,"on",w[2].menu),l&4&&E(U,"on",w[2].xbox),l&4&&E(O,"on",w[2].du),l&4&&E(G,"on",w[2].dr),l&4&&E(z,"on",w[2].dd),l&4&&E(M,"on",w[2].dl),l&4&&E(X,"on",w[2].lb),l&4&&E(Y,"on",w[2].rb),l&16&&R!==(R=w[4]("lt"))&&g(j,"style",R),l&16&&x!==(x=w[4]("rt"))&&g(W,"style",x)},i:te,o:te,d(w){w&&(v(s),v(e)),D&&D.d(w),fe=!1,Le(ye)}}}function Xe(t,s,e){let n,i,c,a=0,f=!1,{ls:_=0}=s,{rs:h=0}=s;const d={a:0,b:0,x:0,y:0,lb:0,rb:0,lt:0,rt:0,map:0,menu:0,lstick:0,rstick:0,du:0,dd:0,dl:0,dr:0,xbox:0},u={lx:0,ly:0,rx:0,ry:0},k=()=>{N(),e(3,f=!0),console.log("GamePad connected")},C=()=>{cancelAnimationFrame(a),e(3,f=!1),console.log("GamePad lost connection")},N=()=>{const o=navigator.getGamepads();if(!o)return;const m=o[0],S=["a","b","x","y","lb","rb","lt","rt","map","menu","lstick","rstick","du","dd","dl","dr","xbox"],V=["lx","ly","rx","ry"];m==null||m.buttons.forEach((T,$)=>{e(2,d[S[$]]=T.pressed?T.value:0,d)}),m==null||m.axes.forEach((T,$)=>{e(9,u[V[$]]=T>.01||T<-.01?parseFloat(T.toFixed(3)):0,u)}),a=requestAnimationFrame(N)};return $e(async()=>{try{N()}catch(o){console.log(o)}}),t.$$set=o=>{"ls"in o&&e(0,_=o.ls),"rs"in o&&e(1,h=o.rs)},t.$$.update=()=>{t.$$.dirty&516&&e(6,n=()=>{let o=u.lx*25,m=u.ly*25,S=u.lx*10,V=u.ly*10,T=1-d.lstick*.05;return e(0,_=Math.round(u.ly*254)*-1),`translateX(${o}%) translateY(${m}%) rotateY(${S}deg) rotateX(${V}deg) scale(${T})`}),t.$$.dirty&516&&e(5,i=()=>{let o=u.rx*25,m=u.ry*25,S=u.rx*10,V=u.ry*10,T=1-d.rstick*.05;return e(1,h=Math.round(u.ry*254)*-1),`translateX(${o}%) translateY(${m}%) rotateY(${S}deg) rotateX(${V}deg) scale(${T})`}),t.$$.dirty&4&&e(4,c=o=>{let m=d[o];return`
			transform: scaleX(${o==="rt"?-m:m}) scaleY(${m}) rotate(-69deg);
			opacity: ${.3+m};
		`})},[_,h,d,f,c,i,n,k,C,u]}class Ye extends ae{constructor(s){super(),ne(this,s,Xe,Me,se,{ls:0,rs:1})}}function je(t){let s,e,n,i,c,a,f,_,h,d,u;function k(o){t[4](o)}function C(o){t[5](o)}let N={};return t[0]!==void 0&&(N.ls=t[0]),t[1]!==void 0&&(N.rs=t[1]),_=new Ye({props:N}),Se.push(()=>Be(_,"ls",k)),Se.push(()=>Be(_,"rs",C)),{c(){s=b("div"),e=b("div"),n=b("span"),i=J(t[2]),c=b("span"),a=J(t[3]),f=I(),de(_.$$.fragment),this.h()},l(o){s=p(o,"DIV",{class:!0});var m=y(s);e=p(m,"DIV",{class:!0});var S=y(e);n=p(S,"SPAN",{});var V=y(n);i=Q(V,t[2]),V.forEach(v),c=p(S,"SPAN",{});var T=y(c);a=Q(T,t[3]),T.forEach(v),S.forEach(v),f=B(m),ve(_.$$.fragment,m),m.forEach(v),this.h()},h(){g(e,"class","filtered svelte-iezy4t"),g(s,"class","wrap svelte-iezy4t")},m(o,m){F(o,s,m),r(s,e),r(e,n),r(n,i),r(e,c),r(c,a),r(s,f),me(_,s,null),u=!0},p(o,[m]){(!u||m&4)&&Z(i,o[2]),(!u||m&8)&&Z(a,o[3]);const S={};!h&&m&1&&(h=!0,S.ls=o[0],Te(()=>h=!1)),!d&&m&2&&(d=!0,S.rs=o[1],Te(()=>d=!1)),_.$set(S)},i(o){u||(he(_.$$.fragment,o),u=!0)},o(o){ge(_.$$.fragment,o),u=!1},d(o){o&&v(s),be(_)}}}function We(t,s,e){let n=0,i=0,c=0,a=0;function f(d,u){d<11&&d>-11?e(2,c=0):e(2,c=d),u<11&&u>-11?e(3,a=0):e(3,a=u),Ve({lm:c,rm:a})}function _(d){n=d,e(0,n)}function h(d){i=d,e(1,i)}return t.$$.update=()=>{t.$$.dirty&3&&f(n,i)},[n,i,c,a,_,h]}class lt extends ae{constructor(s){super(),ne(this,s,We,je,se,{})}}const He=t=>{let s,e=!1;return{isConnected:()=>e,connect:async()=>{var _;if(s=await navigator.bluetooth.requestDevice({filters:[{namePrefix:"nrf52"}],optionalServices:t.map(h=>h.serviceId)}),!s.gatt)throw new Error("No GATT server");const f=await((_=s.gatt)==null?void 0:_.connect());if(!f)throw new Error("No connect to GATT server");return await t.forEach(async h=>await h.addServiceTo(f)),e=!0,s.addEventListener("gattserverdisconnected",h=>{console.error("disconnected BLE",h),e=!1}),!0},disconnect:async()=>{var f;await((f=s==null?void 0:s.gatt)==null?void 0:f.disconnect())},bleDevice:s}},_e=t=>{const{name:s,serviceId:e,characteristicId:n,readParser:i,setParser:c}=t;let a,f;const _=async N=>{if(f=N,!f.connected)throw new Error("BLE Server not connected");console.info("getPrimaryService",e);const o=await f.getPrimaryService(e);return console.log("got primary service",e),a=await o.getCharacteristic(n),console.log("connected to: ",{name:s}),t.isNotifiable&&(console.log("add notification for: ",t.characteristicId),await a.startNotifications(),a.addEventListener("characteristicvaluechanged",m=>{const S=m.target;if(console.log("event",{name:s,event:m}),!i)throw new Error("readParser not defined");S.value&&k(i(S.value))})),!0};async function h(){if(!i)throw new Error("readParser not defined");return f!=null&&f.connected?await i(await a.readValue()):(console.warn("setVal, no connection",{name:s}),i(new DataView(new ArrayBuffer(0))))}async function d(N){await a.writeValue(N)}async function u(N){if(!c)throw new Error("setParser not defined");if(!(f!=null&&f.connected))return console.error(`${s} setVal, no connection`);const o=c(N);console.log("setVal",{value:N,parsedValue:o}),await a.writeValue(o)}let k=N=>{console.warn("onNotification not implemented:",{name:s,value:N})};return{addServiceTo:_,serviceId:e,getVal:h,setVal:u,setValRaw:d,onNotification:N=>{if(!t.isNotifiable)throw new Error(`${s} Characteristic is not set as notifiable`);k=N}}},Ue=_e({name:"Battery",serviceId:"battery_service",characteristicId:"battery_level",isNotifiable:!0,readParser:t=>t.getUint8(0).toString()}),De=_e({name:"Leds",serviceId:"a3941db0-a97c-4cf1-943f-a25ff9ba40cd",characteristicId:"5b8c0ab6-a058-4684-b2b6-4a0a692e2d45",isNotifiable:!1,readParser:t=>(console.log("dataView leds",t),t.getInt8(0)+""+t.getInt8(1)),setParser:t=>{if(typeof t=="string"){const[s,e]=t.split("").map(n=>parseInt(n));return new Uint8Array([s,e])}else return console.log("unhandled data setParser",t),new Uint8Array([0,0])}}),Oe=_e({name:"Servo",serviceId:"847a27cd-ccf0-4f7e-8cb4-d5fe53df2d60",characteristicId:"7c1b818b-dff0-4514-8bcf-f0ad8c79fad9",isNotifiable:!1,readParser:t=>t.getUint8(0),setParser:(t,s)=>{const e=[t,s||90];return new Uint8Array(e).buffer}}),Ke=He([De,Oe,Ue]),Je={...Ke,leds:De,servo:Oe,battery:Ue};function Qe(t){let s,e,n,i;return{c(){s=b("div"),e=b("div"),n=b("div"),this.h()},l(c){s=p(c,"DIV",{class:!0});var a=y(s);e=p(a,"DIV",{class:!0});var f=y(e);n=p(f,"DIV",{class:!0,style:!0}),y(n).forEach(v),f.forEach(v),a.forEach(v),this.h()},h(){g(n,"class",i="battery-level "+t[1]+" svelte-xhchq0"),H(n,"height",t[0]+"%"),g(e,"class","battery svelte-xhchq0"),g(s,"class","wrap svelte-xhchq0")},m(c,a){F(c,s,a),r(s,e),r(e,n)},p(c,[a]){a&2&&i!==(i="battery-level "+c[1]+" svelte-xhchq0")&&g(n,"class",i),a&1&&H(n,"height",c[0]+"%")},i:te,o:te,d(c){c&&v(s)}}}function Ze(t,s,e){let{percent:n}=s,i="";return n<10&&n>0?i="alert":n<30&&n>0?i="warn":n>100?i="charge":i="",t.$$set=c=>{"percent"in c&&e(0,n=c.percent)},[n,i]}class Pe extends ae{constructor(s){super(),ne(this,s,Ze,Qe,se,{percent:0})}}function Re(t){let s,e,n,i,c="Phone",a,f,_,h,d,u="BLE",k,C,N,o,m,S="Gps Acc",V,T=t[0].gps.accuracy+"",$,A;return f=new Pe({props:{percent:t[0].phoneBattery}}),C=new Pe({props:{percent:t[0].bleBattery}}),{c(){s=b("div"),e=b("ul"),n=b("li"),i=b("span"),i.textContent=c,a=I(),de(f.$$.fragment),_=I(),h=b("li"),d=b("span"),d.textContent=u,k=I(),de(C.$$.fragment),N=I(),o=b("li"),m=b("span"),m.textContent=S,V=I(),$=J(T),this.h()},l(P){s=p(P,"DIV",{});var U=y(s);e=p(U,"UL",{});var L=y(e);n=p(L,"LI",{class:!0});var O=y(n);i=p(O,"SPAN",{class:!0,"data-svelte-h":!0}),ee(i)!=="svelte-12ymgw7"&&(i.textContent=c),a=B(O),ve(f.$$.fragment,O),O.forEach(v),_=B(L),h=p(L,"LI",{class:!0});var q=y(h);d=p(q,"SPAN",{class:!0,"data-svelte-h":!0}),ee(d)!=="svelte-4zsvbs"&&(d.textContent=u),k=B(q),ve(C.$$.fragment,q),q.forEach(v),N=B(L),o=p(L,"LI",{class:!0});var G=y(o);m=p(G,"SPAN",{class:!0,"data-svelte-h":!0}),ee(m)!=="svelte-16gqpok"&&(m.textContent=S),V=B(G),$=Q(G,T),G.forEach(v),L.forEach(v),U.forEach(v),this.h()},h(){g(i,"class","label"),g(n,"class","svelte-1y3lrug"),g(d,"class","label"),g(h,"class","svelte-1y3lrug"),g(m,"class","label"),g(o,"class","svelte-1y3lrug")},m(P,U){F(P,s,U),r(s,e),r(e,n),r(n,i),r(n,a),me(f,n,null),r(e,_),r(e,h),r(h,d),r(h,k),me(C,h,null),r(e,N),r(e,o),r(o,m),r(o,V),r(o,$),A=!0},p(P,[U]){const L={};U&1&&(L.percent=P[0].phoneBattery),f.$set(L);const O={};U&1&&(O.percent=P[0].bleBattery),C.$set(O),(!A||U&1)&&T!==(T=P[0].gps.accuracy+"")&&Z($,T)},i(P){A||(he(f.$$.fragment,P),he(C.$$.fragment,P),A=!0)},o(P){ge(f.$$.fragment,P),ge(C.$$.fragment,P),A=!1},d(P){P&&v(s),be(f),be(C)}}}function xe(t,s,e){let n;Ge(t,K,a=>e(0,n=a));let{isSender:i=!1}=s,c=0;return i&&(navigator.geolocation&&navigator.geolocation.getCurrentPosition(a=>{}),navigator.geolocation.watchPosition(a=>{K.update(f=>({...f,gps:{lat:a.coords.latitude,lng:a.coords.longitude,alt:a.coords.altitude,accuracy:a.coords.accuracy}}))}),window.DeviceOrientationEvent&&(window.addEventListener("deviceorientation",function(a){c=a.alpha}),K.update(a=>({...a,compass:c}))),typeof navigator.getBattery<"u"&&navigator.getBattery().then(function(a){console.log("battery1",a.level),Ne(K,n.phoneBattery=a.level*100,n),a.addEventListener("levelchange",function(){console.log("battery2",a.level),Ne(K,n.phoneBattery=a.level*100,n)})}).catch(a=>{console.log("battery error",a)}),Je.battery.onNotification(a=>{console.log("percent",a),Fe({bleBattery:parseInt(a)})})),t.$$set=a=>{"isSender"in a&&e(1,i=a.isSender)},[n,i]}class ot extends ae{constructor(s){super(),ne(this,s,xe,Re,se,{isSender:1})}}export{lt as C,ot as S,rt as a,nt as b,Je as d,pe as s};
