import{f as je,s as ne,n as te,r as Fe,o as ze,b as Se,j as Te,c as Me,i as Be}from"./scheduler.da9d0849.js";import{S as ae,i as le,s as B,g as b,c as C,h as p,j as w,f,k as g,l as W,F as S,a as j,A as a,C as Ce,m as J,z as ee,n as Q,o as Z,G as Ne,r as ve,u as me,v as he,d as ge,t as be,w as pe}from"./index.5d2acbf4.js";import{w as De}from"./index.b9f67257.js";import{s as H,u as Xe}from"./statusStore.cf99fd43.js";const Ue="stear",_e=De({key:Ue,lm:0,rm:0}),Ye=e=>!!(typeof e=="object"&&e&&"key"in e&&e.key===Ue),Oe=e=>{_e.update(s=>({...s,...e}))},ut=e=>{console.log("bindStearingStoreToConnDownStream"),e.on("data",s=>{Ye(s)&&Oe(s)})},ft=e=>{console.log("bindStearingStoreToConnDownStream"),_e.subscribe(t=>{e.send(t)});const s=je(_e);e.send(s)},Ae="btn",se=De({key:Ae,horn:!1,lights:!1});let Ie;const $e=e=>{clearTimeout(Ie),Ie=setTimeout(()=>{e()},100)},Ke=e=>{se.update(s=>({...s,...e}))},We=e=>!!(typeof e=="object"&&e&&"key"in e&&e.key===Ae),dt=e=>{console.log("bindStatusStoreToConnDownStream"),e.on("data",s=>{We(s)&&Ke(s)})},vt=e=>{console.log("bindStatusStoreToConnUpStream"),se.subscribe(s=>{$e(()=>{e.send(s)})})},ke=(e,s)=>{console.log("btnPress!"),$e(()=>{se.update(t=>({...t,[e]:!t[e]})),s||setTimeout(()=>{se.update(t=>({...t,[e]:!1}))},100)})};function Pe(e){let s,t="Gamepad connected",l,o,i,n,c,_,m;return{c(){s=b("span"),s.textContent=t,l=B(),o=b("div"),i=b("div"),n=J(e[0]),c=B(),_=b("div"),m=J(e[1]),this.h()},l(h){s=p(h,"SPAN",{"data-svelte-h":!0}),ee(s)!=="svelte-vjytum"&&(s.textContent=t),l=C(h),o=p(h,"DIV",{class:!0});var v=w(o);i=p(v,"DIV",{class:!0});var T=w(i);n=Q(T,e[0]),T.forEach(f),c=C(v),_=p(v,"DIV",{class:!0});var N=w(_);m=Q(N,e[1]),N.forEach(f),v.forEach(f),this.h()},h(){g(i,"class","svelte-ilam17"),g(_,"class","svelte-ilam17"),g(o,"class","vals svelte-ilam17")},m(h,v){j(h,s,v),j(h,l,v),j(h,o,v),a(o,i),a(i,n),a(o,c),a(o,_),a(_,m)},p(h,v){v&1&&Z(n,h[0]),v&2&&Z(m,h[1])},d(h){h&&(f(s),f(l),f(o))}}}function He(e){let s,t,l,o,i,n,c,_,m,h,v,T,N,I,u,d,y,D,k,V,U,P,O,L,$,q,G,re,F,oe,z,ie,M,ce,X,ue,Y,R,fe,K,x,de,ye,A=e[3]&&Pe(e);return{c(){A&&A.c(),s=B(),t=b("section"),l=b("div"),o=B(),i=b("div"),n=b("div"),c=B(),_=b("div"),m=b("div"),h=B(),v=b("button"),T=B(),N=b("button"),I=B(),u=b("button"),d=B(),y=b("button"),D=B(),k=b("button"),V=B(),U=b("button"),P=B(),O=b("button"),L=B(),$=b("button"),q=B(),G=b("button"),re=B(),F=b("button"),oe=B(),z=b("button"),ie=B(),M=b("button"),ce=B(),X=b("button"),ue=B(),Y=b("button"),fe=B(),K=b("button"),this.h()},l(E){A&&A.l(E),s=C(E),t=p(E,"SECTION",{class:!0});var r=w(t);l=p(r,"DIV",{class:!0}),w(l).forEach(f),o=C(r),i=p(r,"DIV",{class:!0});var we=w(i);n=p(we,"DIV",{class:!0,style:!0}),w(n).forEach(f),we.forEach(f),c=C(r),_=p(r,"DIV",{class:!0});var Ee=w(_);m=p(Ee,"DIV",{class:!0,style:!0}),w(m).forEach(f),Ee.forEach(f),h=C(r),v=p(r,"BUTTON",{class:!0}),w(v).forEach(f),T=C(r),N=p(r,"BUTTON",{class:!0}),w(N).forEach(f),I=C(r),u=p(r,"BUTTON",{class:!0}),w(u).forEach(f),d=C(r),y=p(r,"BUTTON",{class:!0}),w(y).forEach(f),D=C(r),k=p(r,"BUTTON",{class:!0}),w(k).forEach(f),V=C(r),U=p(r,"BUTTON",{class:!0}),w(U).forEach(f),P=C(r),O=p(r,"BUTTON",{class:!0}),w(O).forEach(f),L=C(r),$=p(r,"BUTTON",{class:!0}),w($).forEach(f),q=C(r),G=p(r,"BUTTON",{class:!0}),w(G).forEach(f),re=C(r),F=p(r,"BUTTON",{class:!0}),w(F).forEach(f),oe=C(r),z=p(r,"BUTTON",{class:!0}),w(z).forEach(f),ie=C(r),M=p(r,"BUTTON",{class:!0}),w(M).forEach(f),ce=C(r),X=p(r,"BUTTON",{class:!0}),w(X).forEach(f),ue=C(r),Y=p(r,"BUTTON",{class:!0,style:!0}),w(Y).forEach(f),fe=C(r),K=p(r,"BUTTON",{class:!0,style:!0}),w(K).forEach(f),r.forEach(f),this.h()},h(){g(l,"class","pad svelte-ilam17"),g(n,"class","stick svelte-ilam17"),W(n,"transform",e[6]()),S(n,"click",e[2].lstick),g(i,"class","well left svelte-ilam17"),g(m,"class","stick svelte-ilam17"),W(m,"transform",e[5]()),S(m,"click",e[2].rstick),g(_,"class","well right svelte-ilam17"),g(v,"class","button a svelte-ilam17"),S(v,"on",e[2].a),g(N,"class","button b svelte-ilam17"),S(N,"on",e[2].b),g(u,"class","button x svelte-ilam17"),S(u,"on",e[2].x),g(y,"class","button y svelte-ilam17"),S(y,"on",e[2].y),g(k,"class","button map svelte-ilam17"),S(k,"on",e[2].map),g(U,"class","button menu svelte-ilam17"),S(U,"on",e[2].menu),g(O,"class","button xbox svelte-ilam17"),S(O,"on",e[2].xbox),g($,"class","dpad du svelte-ilam17"),S($,"on",e[2].du),g(G,"class","dpad dr svelte-ilam17"),S(G,"on",e[2].dr),g(F,"class","dpad dd svelte-ilam17"),S(F,"on",e[2].dd),g(z,"class","dpad dl svelte-ilam17"),S(z,"on",e[2].dl),g(M,"class","bumper left svelte-ilam17"),S(M,"on",e[2].lb),g(X,"class","bumper right svelte-ilam17"),S(X,"on",e[2].rb),g(Y,"class","trigger left svelte-ilam17"),g(Y,"style",R=e[4]("lt")),g(K,"class","trigger right svelte-ilam17"),g(K,"style",x=e[4]("rt")),g(t,"class","controller svelte-ilam17")},m(E,r){A&&A.m(E,r),j(E,s,r),j(E,t,r),a(t,l),a(t,o),a(t,i),a(i,n),a(t,c),a(t,_),a(_,m),a(t,h),a(t,v),a(t,T),a(t,N),a(t,I),a(t,u),a(t,d),a(t,y),a(t,D),a(t,k),a(t,V),a(t,U),a(t,P),a(t,O),a(t,L),a(t,$),a(t,q),a(t,G),a(t,re),a(t,F),a(t,oe),a(t,z),a(t,ie),a(t,M),a(t,ce),a(t,X),a(t,ue),a(t,Y),a(t,fe),a(t,K),de||(ye=[Ce(window,"gamepadconnected",e[7]),Ce(window,"gamepaddisconnected",e[8])],de=!0)},p(E,[r]){E[3]?A?A.p(E,r):(A=Pe(E),A.c(),A.m(s.parentNode,s)):A&&(A.d(1),A=null),r&64&&W(n,"transform",E[6]()),r&4&&S(n,"click",E[2].lstick),r&32&&W(m,"transform",E[5]()),r&4&&S(m,"click",E[2].rstick),r&4&&S(v,"on",E[2].a),r&4&&S(N,"on",E[2].b),r&4&&S(u,"on",E[2].x),r&4&&S(y,"on",E[2].y),r&4&&S(k,"on",E[2].map),r&4&&S(U,"on",E[2].menu),r&4&&S(O,"on",E[2].xbox),r&4&&S($,"on",E[2].du),r&4&&S(G,"on",E[2].dr),r&4&&S(F,"on",E[2].dd),r&4&&S(z,"on",E[2].dl),r&4&&S(M,"on",E[2].lb),r&4&&S(X,"on",E[2].rb),r&16&&R!==(R=E[4]("lt"))&&g(Y,"style",R),r&16&&x!==(x=E[4]("rt"))&&g(K,"style",x)},i:te,o:te,d(E){E&&(f(s),f(t)),A&&A.d(E),de=!1,Fe(ye)}}}function Je(e,s,t){let l,o,i,n=0,c=!1,{ls:_=0}=s,{rs:m=0}=s;const h={y:()=>{ke("horn",!1)},x:()=>{ke("lights",!0)}},v={a:0,b:0,x:0,y:0,lb:0,rb:0,lt:0,rt:0,map:0,menu:0,lstick:0,rstick:0,du:0,dd:0,dl:0,dr:0,xbox:0},T={lx:0,ly:0,rx:0,ry:0},N=()=>{u(),t(3,c=!0),console.log("GamePad connected")},I=()=>{cancelAnimationFrame(n),t(3,c=!1),console.log("GamePad lost connection")},u=()=>{const d=navigator.getGamepads();if(!d)return;const y=d[0],D=["a","b","x","y","lb","rb","lt","rt","map","menu","lstick","rstick","du","dd","dl","dr","xbox"],k=["lx","ly","rx","ry"];y==null||y.buttons.forEach((V,U)=>{const P=D[U];t(2,v[D[U]]=V.pressed?V.value:0,v),h[P]&&V.pressed&&h[P]()}),y==null||y.axes.forEach((V,U)=>{t(9,T[k[U]]=V>.01||V<-.01?parseFloat(V.toFixed(3)):0,T)}),n=requestAnimationFrame(u)};return ze(async()=>{try{u()}catch(d){console.log(d)}}),e.$$set=d=>{"ls"in d&&t(0,_=d.ls),"rs"in d&&t(1,m=d.rs)},e.$$.update=()=>{e.$$.dirty&516&&t(6,l=()=>{let d=T.lx*25,y=T.ly*25,D=T.lx*10,k=T.ly*10,V=1-v.lstick*.05;return t(0,_=Math.round(T.ly*254)*-1),`translateX(${d}%) translateY(${y}%) rotateY(${D}deg) rotateX(${k}deg) scale(${V})`}),e.$$.dirty&516&&t(5,o=()=>{let d=T.rx*25,y=T.ry*25,D=T.rx*10,k=T.ry*10,V=1-v.rstick*.05;return t(1,m=Math.round(T.ry*254)*-1),`translateX(${d}%) translateY(${y}%) rotateY(${D}deg) rotateX(${k}deg) scale(${V})`}),e.$$.dirty&4&&t(4,i=d=>{let y=v[d];return`
			transform: scaleX(${d==="rt"?-y:y}) scaleY(${y}) rotate(-69deg);
			opacity: ${.3+y};
		`})},[_,m,v,c,i,o,l,N,I,T]}class Qe extends ae{constructor(s){super(),le(this,s,Je,He,ne,{ls:0,rs:1})}}function Ze(e){let s,t,l,o,i,n,c,_,m,h,v;function T(u){e[4](u)}function N(u){e[5](u)}let I={};return e[0]!==void 0&&(I.ls=e[0]),e[1]!==void 0&&(I.rs=e[1]),_=new Qe({props:I}),Se.push(()=>Ne(_,"ls",T)),Se.push(()=>Ne(_,"rs",N)),{c(){s=b("div"),t=b("div"),l=b("span"),o=J(e[2]),i=b("span"),n=J(e[3]),c=B(),ve(_.$$.fragment),this.h()},l(u){s=p(u,"DIV",{class:!0});var d=w(s);t=p(d,"DIV",{class:!0});var y=w(t);l=p(y,"SPAN",{});var D=w(l);o=Q(D,e[2]),D.forEach(f),i=p(y,"SPAN",{});var k=w(i);n=Q(k,e[3]),k.forEach(f),y.forEach(f),c=C(d),me(_.$$.fragment,d),d.forEach(f),this.h()},h(){g(t,"class","filtered svelte-iezy4t"),g(s,"class","wrap svelte-iezy4t")},m(u,d){j(u,s,d),a(s,t),a(t,l),a(l,o),a(t,i),a(i,n),a(s,c),he(_,s,null),v=!0},p(u,[d]){(!v||d&4)&&Z(o,u[2]),(!v||d&8)&&Z(n,u[3]);const y={};!m&&d&1&&(m=!0,y.ls=u[0],Te(()=>m=!1)),!h&&d&2&&(h=!0,y.rs=u[1],Te(()=>h=!1)),_.$set(y)},i(u){v||(ge(_.$$.fragment,u),v=!0)},o(u){be(_.$$.fragment,u),v=!1},d(u){u&&f(s),pe(_)}}}function Re(e,s,t){let l=0,o=0,i=0,n=0;function c(h,v){h<11&&h>-11?t(2,i=0):t(2,i=h),v<11&&v>-11?t(3,n=0):t(3,n=v),Oe({lm:i,rm:n})}function _(h){l=h,t(0,l)}function m(h){o=h,t(1,o)}return e.$$.update=()=>{e.$$.dirty&3&&c(l,o)},[l,o,i,n,_,m]}class mt extends ae{constructor(s){super(),le(this,s,Re,Ze,ne,{})}}const xe=e=>{let s,t=!1;return{isConnected:()=>t,connect:async()=>{var _;if(s=await navigator.bluetooth.requestDevice({filters:[{namePrefix:"nrf52"}],optionalServices:e.map(m=>m.serviceId)}),!s.gatt)throw new Error("No GATT server");const c=await((_=s.gatt)==null?void 0:_.connect());if(!c)throw new Error("No connect to GATT server");return await e.forEach(async m=>await m.addServiceTo(c)),t=!0,s.addEventListener("gattserverdisconnected",m=>{console.error("disconnected BLE",m),t=!1}),!0},disconnect:async()=>{var c;await((c=s==null?void 0:s.gatt)==null?void 0:c.disconnect())},bleDevice:s}},Le=e=>{const{name:s,serviceId:t,characteristicId:l,readParser:o,setParser:i}=e;let n,c;const _=async I=>{if(c=I,!c.connected)throw new Error("BLE Server not connected");console.info("getPrimaryService",t);const u=await c.getPrimaryService(t);return console.log("got primary service",t),n=await u.getCharacteristic(l),console.log("connected to: ",{name:s}),e.isNotifiable&&(console.log("add notification for: ",e.characteristicId),await n.startNotifications(),n.addEventListener("characteristicvaluechanged",d=>{const y=d.target;if(console.log("event",{name:s,event:d}),!o)throw new Error("readParser not defined");y.value&&T(o(y.value))})),!0};async function m(){if(!o)throw new Error("readParser not defined");return c!=null&&c.connected?await o(await n.readValue()):(console.warn("setVal, no connection",{name:s}),o(new DataView(new ArrayBuffer(0))))}async function h(I){await n.writeValue(I)}async function v(I){if(!i)throw new Error("setParser not defined");if(!(c!=null&&c.connected))return console.error(`${s} setVal, no connection`);const u=i(I);console.log("setVal",{value:I,parsedValue:u}),await n.writeValue(u)}let T=I=>{console.warn("onNotification not implemented:",{name:s,value:I})};return{addServiceTo:_,serviceId:t,getVal:m,setVal:v,setValRaw:h,onNotification:I=>{if(!e.isNotifiable)throw new Error(`${s} Characteristic is not set as notifiable`);T=I}}},Ge=Le({name:"Battery",serviceId:"battery_service",characteristicId:"battery_level",isNotifiable:!0,readParser:e=>e.getUint8(0).toString()}),qe=Le({name:"Leds",serviceId:"a3941db0-a97c-4cf1-943f-a25ff9ba40cd",characteristicId:"5b8c0ab6-a058-4684-b2b6-4a0a692e2d45",isNotifiable:!1,readParser:e=>(console.log("dataView leds",e),e.getInt8(0)+""+e.getInt8(1)),setParser:e=>{if(typeof e=="string"){const[s,t]=e.split("").map(l=>parseInt(l));return new Uint8Array([s,t])}else return console.log("unhandled data setParser",e),new Uint8Array([0,0])}}),et=xe([qe,Ge]),tt={...et,leds:qe,battery:Ge};function st(e){let s,t,l,o;return{c(){s=b("div"),t=b("div"),l=b("div"),this.h()},l(i){s=p(i,"DIV",{class:!0});var n=w(s);t=p(n,"DIV",{class:!0});var c=w(t);l=p(c,"DIV",{class:!0,style:!0}),w(l).forEach(f),c.forEach(f),n.forEach(f),this.h()},h(){g(l,"class",o="battery-level "+e[1]+" svelte-xhchq0"),W(l,"height",e[0]+"%"),g(t,"class","battery svelte-xhchq0"),g(s,"class","wrap svelte-xhchq0")},m(i,n){j(i,s,n),a(s,t),a(t,l)},p(i,[n]){n&2&&o!==(o="battery-level "+i[1]+" svelte-xhchq0")&&g(l,"class",o),n&1&&W(l,"height",i[0]+"%")},i:te,o:te,d(i){i&&f(s)}}}function nt(e,s,t){let{percent:l}=s,o="";return l<10&&l>0?o="alert":l<30&&l>0?o="warn":l>100?o="charge":o="",e.$$set=i=>{"percent"in i&&t(0,l=i.percent)},[l,o]}class Ve extends ae{constructor(s){super(),le(this,s,nt,st,ne,{percent:0})}}function at(e){let s,t,l,o,i="Phone",n,c,_,m,h,v="BLE",T,N,I,u,d,y="Gps Acc",D,k=e[0].gps.accuracy+"",V,U;return c=new Ve({props:{percent:e[0].phoneBattery}}),N=new Ve({props:{percent:e[0].bleBattery}}),{c(){s=b("div"),t=b("ul"),l=b("li"),o=b("span"),o.textContent=i,n=B(),ve(c.$$.fragment),_=B(),m=b("li"),h=b("span"),h.textContent=v,T=B(),ve(N.$$.fragment),I=B(),u=b("li"),d=b("span"),d.textContent=y,D=B(),V=J(k),this.h()},l(P){s=p(P,"DIV",{});var O=w(s);t=p(O,"UL",{});var L=w(t);l=p(L,"LI",{class:!0});var $=w(l);o=p($,"SPAN",{class:!0,"data-svelte-h":!0}),ee(o)!=="svelte-12ymgw7"&&(o.textContent=i),n=C($),me(c.$$.fragment,$),$.forEach(f),_=C(L),m=p(L,"LI",{class:!0});var q=w(m);h=p(q,"SPAN",{class:!0,"data-svelte-h":!0}),ee(h)!=="svelte-4zsvbs"&&(h.textContent=v),T=C(q),me(N.$$.fragment,q),q.forEach(f),I=C(L),u=p(L,"LI",{class:!0});var G=w(u);d=p(G,"SPAN",{class:!0,"data-svelte-h":!0}),ee(d)!=="svelte-16gqpok"&&(d.textContent=y),D=C(G),V=Q(G,k),G.forEach(f),L.forEach(f),O.forEach(f),this.h()},h(){g(o,"class","label"),g(l,"class","svelte-1y3lrug"),g(h,"class","label"),g(m,"class","svelte-1y3lrug"),g(d,"class","label"),g(u,"class","svelte-1y3lrug")},m(P,O){j(P,s,O),a(s,t),a(t,l),a(l,o),a(l,n),he(c,l,null),a(t,_),a(t,m),a(m,h),a(m,T),he(N,m,null),a(t,I),a(t,u),a(u,d),a(u,D),a(u,V),U=!0},p(P,[O]){const L={};O&1&&(L.percent=P[0].phoneBattery),c.$set(L);const $={};O&1&&($.percent=P[0].bleBattery),N.$set($),(!U||O&1)&&k!==(k=P[0].gps.accuracy+"")&&Z(V,k)},i(P){U||(ge(c.$$.fragment,P),ge(N.$$.fragment,P),U=!0)},o(P){be(c.$$.fragment,P),be(N.$$.fragment,P),U=!1},d(P){P&&f(s),pe(c),pe(N)}}}function lt(e,s,t){let l;Me(e,H,n=>t(0,l=n));let{isSender:o=!1}=s,i=0;return o&&(navigator.geolocation&&navigator.geolocation.getCurrentPosition(n=>{}),navigator.geolocation.watchPosition(n=>{H.update(c=>({...c,gps:{lat:n.coords.latitude,lng:n.coords.longitude,alt:n.coords.altitude,accuracy:n.coords.accuracy}}))}),window.DeviceOrientationEvent&&(window.addEventListener("deviceorientation",function(n){i=n.alpha}),H.update(n=>({...n,compass:i}))),typeof navigator.getBattery<"u"&&navigator.getBattery().then(function(n){console.log("battery1",n.level),Be(H,l.phoneBattery=n.level*100,l),n.addEventListener("levelchange",function(){console.log("battery2",n.level),Be(H,l.phoneBattery=n.level*100,l)})}).catch(n=>{console.log("battery error",n)}),tt.battery.onNotification(n=>{console.log("percent",n),Xe({bleBattery:parseInt(n)})})),e.$$set=n=>{"isSender"in n&&t(1,o=n.isSender)},[l,o]}class ht extends ae{constructor(s){super(),le(this,s,lt,at,ne,{isSender:1})}}export{mt as C,ht as S,dt as a,ut as b,se as c,tt as d,ke as e,ft as f,vt as g,_e as s};
